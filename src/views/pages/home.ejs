<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - QuickShare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        html,
        body {
            height: 100%;
        }

        .nav {
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 9999;
        }

        .wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1;
        }

        .nav-link.active {
            font-weight: bold;
            color: #fff !important;
        }

        #flashMessage {
            position: fixed;
            top: 10%;
            left: 85%;
            transform: translateX(-50%);
            z-index: 9999;
            width: 45%;
            max-width: 300px;
            margin: 0 auto;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translate(-50%, -60%);
            }

            10%,
            90% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
        }

        .card-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .card {
            width: 18rem;
        }
    </style>
</head>

<body>
    <% if (messages.success) { %>
        <div id="flashMessage" class="alert alert-success">
            <%= messages.success %>
        </div>
        <% } %>
            <% if (messages.error) { %>
                <div id="flashMessage" class="alert alert-danger">
                    <%= messages.error %>
                </div>
                <% } %>
                    <div class="wrapper">
                        <nav class="nav navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
                            <div class="container-fluid">
                                <a class="navbar-brand fs-3 fw-bold" href=" http://192.168.1.8:9090/home">QuickShare</a>
                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                                    aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>
                                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                                    <ul class="navbar-nav">
                                        <li class="nav-item">
                                            <a class="nav-link active" href=" http://192.168.1.8:9090/home">Home</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="#" onclick="loadPage('my-uploads', this)">My
                                                Uploads</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="#" onclick="loadPage('shared-files', this)">My
                                                Shared Files</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="#" onclick="loadPage('profile', this)">
                                                Profile
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/logout">Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </nav>

                        <div id="content" class="content d-flex justify-content-center align-items-center vh-100">
                            <div>
                                <h2 class="mt-4 text-center">Welcome to QuickShare</h2>
                                <p class="mb-5 text-center">Upload and share your files effortlessly. Choose a plan
                                    below to get
                                    started!</p>
                                <div class="d-flex justify-content-center gap-3">
                                    <div class="card shadow-sm">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">Basic Plan</h5>
                                            <p class="card-text">Enjoy 10 GB of free storage with essential features.
                                            </p>
                                            <a href="#" class="btn btn-primary">Subscribe</a>
                                        </div>
                                    </div>
                                    <div class="card shadow-sm">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">Pro Plan</h5>
                                            <p class="card-text">Get 50 GB of storage and premium features for just
                                                $5/month.</p>
                                            <a href="#" class="btn btn-success">Subscribe</a>
                                        </div>
                                    </div>
                                    <div class="card shadow-sm">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">Enterprise Plan</h5>
                                            <p class="card-text">Unlimited storage and advanced support for teams.</p>
                                            <a href="#" class="btn btn-warning">Subscribe</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <footer class="text-grey text-center">
                            <p>&copy; 2024 QuickShare. All Rights Reserved.</p>
                        </footer>
                    </div>

                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
                        crossorigin="anonymous"></script>
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
                    <script>
                        function loadPage(page, clickedLink) {
                            const contentDiv = document.getElementById('content');
                            const xhr = new XMLHttpRequest();
                            xhr.open('GET', `/${page}`, true);
                            xhr.onload = function () {
                                if (xhr.status === 200) {
                                    contentDiv.innerHTML = xhr.responseText;
                                    setActiveTab(clickedLink);
                                    const newUrl = `/home?tab=${page}`;
                                    window.history.pushState({ path: newUrl }, '', newUrl);
                                }
                            };
                            xhr.send();
                        }

                        function setActiveTab(clickedLink) {
                            const navLinks = document.querySelectorAll('.nav-link');
                            navLinks.forEach(link => {
                                link.classList.remove('active');
                            });
                            clickedLink.classList.add('active');
                        }

                        document.addEventListener("DOMContentLoaded", function () {
                            const homeTab = document.querySelector('.nav-link.active');
                            if (!homeTab) {
                                const defaultTab = document.querySelector('a[href="http://192.168.1.8:9090/"]');
                                defaultTab.classList.add('active');
                            }
                        });

                        function openImage(url) {
                            window.open(url, '_blank');
                        }

                        // function downloadFile(assetId) {
                        //     const fileUrl = `https://res-console.cloudinary.com/dwdqnqxr1/media_explorer_thumbnails/${assetId}/download`;
                        //     window.location.href = fileUrl;

                        //     fetch(`/file/delete-after-download/${assetId}`, {
                        //         method: 'POST',
                        //     })
                        // }
                        function downloadFile(assetId, fileName) {
                            // Call the backend API to delete the file after download
                            fetch(`/file/delete-after-download/${fileName}`, {
                                method: 'POST',
                            })
                                .then(response => {
                                    if (response.ok) {
                                        // Once deletion is initiated, redirect to the Cloudinary download URL
                                        const fileUrl = `https://res-console.cloudinary.com/dwdqnqxr1/media_explorer_thumbnails/${assetId}/download`;
                                        window.location.href = fileUrl; // Trigger the download
                                    } else {
                                        console.error('Failed to delete the file from the server.');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        }


                        function deleteFile(publicId) {
                            if (confirm('Are you sure you want to delete this file?')) {
                                fetch(`/file/delete-file/${publicId}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        }


                        // function shareFile(fileId) {
                        //     document.getElementById('fileId').value = fileId;
                        //     const shareModal = new bootstrap.Modal(document.getElementById('shareModal'));
                        //     shareModal.show();
                        // }

                        // Handle share form submission
                        // document.getElementById('shareForm').addEventListener('submit', function (e) {
                        //     console.log("CLCIKED");

                        //     e.preventDefault();

                        //     const email = document.getElementById('shareEmail').value;
                        //     const fileId = document.getElementById('fileId').value;

                        //     fetch('/file/share', {
                        //         method: 'POST',
                        //         headers: {
                        //             'Content-Type': 'application/json',
                        //         },
                        //         body: JSON.stringify({ email, fileId }),
                        //     })
                        //         .then(response => response.json())
                        //         .then(data => {
                        //             if (data.success) {
                        //                 alert('File shared successfully!');
                        //                 location.reload();
                        //             } else {
                        //                 alert(data.message || 'Failed to share the file.');
                        //             }
                        //         })
                        //         .catch(err => console.error('Error sharing file:', err));
                        // });
                        function setFileId(fileId) {
                            console.log(fileId);

                            document.getElementById('fileId').value = fileId;
                        }
                        setTimeout(() => {
                            document.getElementById("flashMessage").style.display = 'none';
                        }, 2000);
                    </script>
</body>

</html>